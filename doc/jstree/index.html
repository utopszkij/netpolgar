<html>
<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
  crossorigin="anonymous"></script>

  <style type="text/css">
  .treejs-label {display:inline-block; max-width:400px; margin-top:5px}
  </style>	
<body>
	<h2>tree</h2>
	<button type="button" onclick="">edit</button>
	<button type="button" onclick="">delete</button>
	<button type="button" onclick="addSibling(treeData)">+sibling</button>
	<button type="button" onclick="">+child</button>
	Must only one selected!
	<div id="container"></div>
</body>

<script src="tree.js"></script>
<script>
var treeData = [
  {
    id: '0',
    text: 'node-0',
    children: [
      {
        id: '0-0',
        text: 'node-0-0',
        children: [
          {id: '0-0-0', text: 'node-0-0-0'},
          {id: '0-0-1', text: 'node-0-0-1'},
          {id: '0-0-2', text: 'node-0-0-2'},
        ],
      },
      {id: '0-1', text: 'node-0-1'},
    ],
  },
  {
    id: '1',
    text: 'node-1',
    children: [{id: '1-0', text: 'node-1-0'}, {id: '1-1', text: 'node-1-1'}],
  },
];

// KSH nomnklatura 2021
var treeData = [
{"id":2000, "text":"Anyagi termékek", "children":[
{"id": 1, "text":"Élő állatok, állati eredetü termékek", "children":[
{"id":"1001","text":"Hús és élelmezési célra alkalmas vágási melléktermékek és belsőségek"},
{"id":"1003","text":"Halak és rákfélék, puhatestű és más gerinctelen víziállatok"},
{"id":"1004","text":"Tejtermékek; madártojás; természetes méz; máshol nem említett, élelmezési célra alkalmas állati eredetű élelmiszer"}, 
{"id":"1005","text":"Máshol nem említett állati eredetű termékek"},
]},

{"id":2, "text":"Növényi termékek", children:[
{"id":1006, "text":"Élő fák és más növények; hagymák, gumók, gyökerek és hasonlók; vágott virágok és díszítőlombozat"},
{"id":1007, "text":"Élelmezési célra alkalmas zöldségfélék, és egyes gyökerek és gumók"},
{"id":1008, "text":"Élelmezési célra alkalmas gyümölcs és diófélék; citrusfélék vagy a dinnyefélék héja"},
{"id":1009, "text":"Kávé, tea, matétea és fűszerek"},
{"id":1010, "text":"Gabonafélék"},
{"id":1011, "text":"Malomipari termékek; maláta; keményítők; inulin; búzasikér"},
{"id":1012, "text":"Olajos magvak és olajtartalmú gyümölcsök; különféle magvak és gyümölcsök; ipari vagy gyógynövények; szalma és takarmány"},
{"id":1013, "text":"Sellak; mézga, gyanta és más növényi nedv és kivonat"},
{"id":1014, "text":"Növényi eredetű nyersanyag fonásra; máshol nem említett növényi termékek"},
]},

{"id":3, "text":"Állati vagy növényi zsír és olaj és ezek bontási termékei; elkészített ételzsír; állati vagy növényi eredetű viasz", "children":[
{"id":1015, "text":"Állati vagy növényi zsír és olaj és ezek bontási termékei; elkészített ételzsír; állati vagy növényi eredetű viasz"}, 
]},

{"id":4, "text":"Élelmiszer-készítmények; italok, alkoholtartalmú folyadékok és ecet; dohány és elkészített dohánypótlók", "children":[
{"id":1016, "text":"Húsból, halból vagy rákféléből, puhatestűből, vagy más gerinctelen víziállatból készült termékek"},
{"id":1017, "text":"Cukor és cukoráruk"},
{"id":1018, "text":"Kakaó és kakaókészítmények"},
{"id":1019, "text":"Gabona, liszt, keményítő vagy tej felhasználásával készült termékek; cukrászati termékek"},
{"id":1020, "text":"Zöldségfélékből, gyümölcsből, diófélékből vagy más növényrészekből előállított készítmények"},
{"id":1022, "text":"Italok, alkoholtartalmú folyadékok és ecet"},
{"id":1023, "text":"Az élelmiszeripar melléktermékei és hulladékai; elkészített állati takarmány"},
{"id":1021, "text":"Különféle ehető készítmények"},
{"id":1024, "text":"Dohány és feldolgozott dohánypótló"},
]},

{"id":5, "text":"Ásványi termékek", "children":[
{"id":1025, "text":"Só; kén; földek és kövek; gipsz, mész és cement"},
{"id":1026, "text":"Ércek, salakok és hamu"},
{"id":1027, "text":"Ásványi tüzelőanyagok, ásványi olajok és ezek desztillációs termékei; bitumenes anyagok; ásványi viaszok"},
]},

{"id":6, "text":"A vegyipar vagy vele rokon iparok termékei", "children":[
{"id":1028, "text":"Szervetlen vegyi anyagok; szervetlen vagy szerves vegyületek nemesfémből, ritkaföldfémből, radioaktív elemekből vagy izotópokból"},
{"id":1029, "text":"Szerves vegyi anyagok"},
{"id":1030, "text":"Gyógyszeripari termékek"},
{"id":1031, "text":"Trágyázószerek"},
{"id":1032, "text":"Cserző- vagy színezőkivonatok; tanninok és származékaik; színezékek, pigmentek és más színező anyagok; festékek és lakkok; gitt és más masztix (simító- és tömítőanyagok); tinták"},
{"id":1033, "text":"Illóolajok és rezinoidok; illatszerek, szépség- vagy testápoló készítmények"},
{"id":1034, "text":"Szappan, szerves felületaktív anyagok, mosószerek, kenőanyagok, műviaszok, elkészített viaszok, fényesítő- vagy polírozóanyagok, gyertya és hasonló termékek, mintázópaszta, „fogászati viasz” és gipszalapú fogászati készítmények"},
{"id":1035, "text":"Fehérjeanyagok; átalakított keményítők; enyvek; enzimek"},
{"id":1036, "text":"Robbanóanyagok; pirotechnikai készítmények; gyufák; piroforos ötvözetek; egyes gyúlékony anyagok"},
{"id":1037, "text":"Fényképészeti vagy mozgófényképészeti termékek"},
]},

{"id":7, "text":"Műanyagok és ezekből készült áruk; gumi és ebből készült áruk", "children":[
{"id":1039, "text":"Műanyagok és ezekből készült áruk"},
{"id":1040, "text":"Gumi és ebből készült áruk"},
]},

{"id":8, "text":"Nyersbőr, kikészített bőr, szőrme és ezekből készült áruk; nyerges- és szíjgyártóáruk; utazási cikkek, kézitáskák és hasonló tartók; állati bélből készült áruk (a selyemhernyóbélből készült áruk kivételével)", "children":[
{"id":1041, "text":"Nyersbőr (a szőrme kivételével) és kikészített bőr"},
{"id":1042, "text":"Bőráruk; nyerges- és szíjgyártóáruk; utazási cikkek, kézitáskák és hasonló tartók; állati bélből készült áruk (a selyemhernyóbélből készült áruk kivételével)"},
{"id":1043, "text":"Szőrme és műszőrme; ezekből készült áruk"},
]},

{"id":9, "text":"Fa és faipari termékek; faszén; parafa és parafaáruk; szalmából, eszpartófűből vagy más fonásanyagokból készült áruk; kosárkötő- és fonásáruk", "children":[
{"id":1044, "text":"Fa és faipari termékek; faszén"},
{"id":1046, "text":"Szalmából, eszpartófűből vagy más fonásanyagból készült áruk; kosárkötő- és fonásáruk"},
]},

{"id":10, "text":"Papíripari rostanyag fából vagy más cellulóztartalmú anyagból; visszanyert (hulladék és használt) papír vagy karton; papír és karton és ezekből készült áruk", "children":[
{"id":1047, "text":"Papíripari rostanyag fából vagy más cellulóztartalmú anyagból; visszanyert (hulladék és használt) papír vagy karton"},
{"id":1048, "text":"Papír és karton; papíripari rostanyagból, papírból vagy kartonból készült áruk"},
{"id":1049, "text":"Könyvek, újságok, képek és más nyomdaipari termékek; kéziratok, gépírásos szövegek és tervrajzok"},
]},

{"id":11, "text":"Textilipari alapanyagok és textiláruk", "children":[
{"id":1052, "text":"Pamut"},
{"id":1053, "text":"Más növényi textilszálak; papírfonal és papírfonalból szőtt szövet"},
{"id":1054, "text":"Szintetikus vagy mesterséges végtelen szálak (végtelen műszálak); szintetikus vagy mesterséges textilanyagból készült szalag és hasonlók"},
{"id":1055, "text":"Szintetikus vagy mesterséges vágott szálak (vágott műszálak)"},
{"id":1056, "text":"Vatta, nemez és nem szőtt textília; különleges fonalak; zsineg, kötél, hajókötél és kábel, valamint ezekből készült áruk"},
{"id":1057, "text":"Szőnyegek és más textil padlóborítók"},
{"id":1058, "text":"Különleges szövetek; bolyhos szövetek; csipke; kárpit; paszomány; hímzés"},
{"id":1059, "text":"Impregnált, bevont, beborított vagy réteges szövetek; műszaki textiláru"},
{"id":1060, "text":"Kötött vagy hurkolt kelmék"},
{"id":1061, "text":"Kötött vagy hurkolt ruházati cikkek, kellékek és tartozékok"},
{"id":1062, "text":"Ruházati cikkek, kellékek és tartozékok, a kötött vagy hurkolt áruk kivételével"}, 
{"id":1063, "text":"Más készáru textilanyagból; készletek; használt ruha és használt textiláru; rongy"},
]},

{"id":12, "text":"Lábbeli, fejfedő, esernyők, napernyők, sétabotok, botszékek, ostorok, lovaglókorbácsok és ezek alkatrészei; kikészített tollak és ebből készült áruk; művirágok; emberhajból készült áruk", "children":[
{"id":1064, "text":"Lábbeli, lábszárvédő és hasonló áruk; ezek alkatrészei"},
{"id":1065, "text":"Kalap és más fejfedők, valamint ezek alkatrészei"},
{"id":1066, "text":"Esernyők, napernyők, sétabotok, botszékek, ostorok, lovaglókorbácsok és ezek alkatrészei"},
{"id":1067, "text":"Kikészített toll és pehely, valamint ezekből készült áruk; művirágok; emberhajból készült áruk"},
]},

{"id":13, "text":"Kőből, gipszből, cementből, azbesztből, csillámból vagy hasonló anyagokból készült áruk; kerámiatermékek; üvegek és üvegáruk", "children":[
{"id":1068, "text":"Kőből, gipszből, cementből, azbesztből, csillámból vagy hasonló anyagokból készült áruk"},
{"id":1069, "text":"Kerámiatermékek"},
{"id":1070, "text":"Üveg és üvegáruk"},
]},

{"id":14, "text":"Természetes vagy tenyésztett gyöngyök, drágakövek vagy féldrágakövek, nemesfémek, nemesfémmel plattírozott fémek és ezekből készült áruk; ékszerutánzatok; érmék", "children":[
{"id":1071, "text":"Természetes vagy tenyésztett gyöngyök, drágakövek vagy féldrágakövek, nemesfémek, nemesfémmel plattírozott fémek és ezekből készült áruk; ékszerutánzatok; érmék"},
]},

{"id":15, "text":"Nem nemesfémek és ezekből készült áruk", "children":[
{"id":1072, "text":"Vas és acél"},
{"id":1073, "text":"Vas- vagy acéláruk"},
{"id":1074, "text":"Réz és ebből készült áruk"},
{"id":1075, "text":"Nikkel és ebből készült áruk"},
{"id":1076, "text":"Alumínium és ebből készült áruk"},
{"id":1077, "text":"(A harmonizált rendszerben történő későbbi felhasználásra fenntartva)"},
{"id":1078, "text":"Ólom és ebből készült áruk"},
{"id":1079, "text":"Cink és ebből készült áruk"},
{"id":1080, "text":"Ón és ebből készült áruk"},
{"id":1081, "text":"Más nem nemesfém; cermet; ezekből készült áruk"},
{"id":1082, "text":"Szerszámok, késművesáruk, evőeszközök, kanál és villa nem nemesfémből; mindezek részei nem nemesfémből"},
{"id":1083, "text":"Máshol nem említett különféle áruk nem nemesfémből"},
]},

{"id":16,"text":"Gépek és mechanikus berendezések; villamossági cikkek; ezek alkatrészei; hangfelvevő és -lejátszó készülékek, kép- és hangfelvevő és -lejátszó készülékek televízióhoz; ezek alkatrészei és tartozékai", "children":[
{"id":1084, "text":"Atomreaktorok, kazánok, gépek és mechanikus berendezések; ezek alkatrészei"},
{"id":1085, "text":"Elektromos gépek és elektromos felszerelések és ezek alkatrészei; hangfelvevő és -lejátszó, televíziós kép- és hangfelvevő és -lejátszó készülékek és ezek alkatrészei és tartozékai"},
]},

{"id":17, "text":"Járművek, légi járművek, vízi járművek és szállítás céljára szolgáló felszerelések", "children":[
{"id":1086, "text":"Vasúti mozdonyok vagy villamos-motorkocsik, sínhez kötött járművek és alkatrészeik; vasúti vagy villamosvágány-tartozékok és -felszerelések és alkatrészeik; mindenféle mechanikus (beleértve az elektrome­ chanikusat is) közlekedési jelzőberendezés"},
{"id":1087, "text":"Járművek és ezek alkatrészei és tartozékai, a vasúti vagy villamosvasúti sínhez kötött járművek kivételével"},
{"id":1088, "text":"Légi járművek, űrhajók és ezek alkatrészei"},
{"id":1089, "text":"Hajók, csónakok és más úszószerkezetek"},
]},

{"id":18,"text":"Optikai, fényképészeti, mozgófényképészeti, mérő-, ellenőrző, precíziós, orvosi vagy sebészeti műszerek és készülékek; órák és kisórák; hangszerek; mindezek alkatrészei és tartozékai", "children":[
{"id":1090, "text":"Optikai, fényképészeti, mozgófényképészeti, mérő-, ellenőrző, precíziós, orvosi vagy sebészeti műszerek és készülékek; mindezek alkatrészei és tartozékai"},
{"id":1091, "text":"Órák és kisórák és ezek alkatrészei"},
{"id":1092, "text":"Hangszerek; mindezek alkatrészei és tartozékai"},
]},

{"id":19,"text":"Fegyverek és lőszerek; ezek alkatrészei és tartozékai", "children":[
{"id":1093, "text":"Fegyverek és lőszerek; ezek alkatrészei és tartozékai"},
]},

{"id":20, "text":"Különféle áruk", "children":[
{"id":1094, "text":"Bútor; ágyfelszerelés, matracok, ágybetétek, párnák és hasonló párnázott lakberendezési cikkek; máshol nem említett lámpák és világítófelszerelések; megvilágított jelzések, reklámfeliratok, névtáblák és hasonlók; előre gyártott épületek"},
{"id":1095, "text":"Játékok, játékszerek és sporteszközök; mindezek alkatrészei és tartozékai"},
{"id":1096, "text":"Különböző áruk"},
]},

{"id":21, "text":"Művészeti tárgyak, gyűjteménydarabok és régiségek", "children":[
{"id":1097, "text":"Művészeti tárgyak, gyűjteménydarabok és régiségek"},
{"id":1098, "text":"Komplett ipari létesítmények"},
{"id":1099, "text":"Speciális Kombinált Nómenklatúra-kódok"},
]}
]},
{"id":2001, "text":"Szellemi termékek"}
];

var myTree = new Tree('#container', {
  data: treeData,
  closeDepth:2,
  onChange: function() {
    window.setTimeout(onlyOne,300);
  },
});

var lastSelect = '';
var newId = 100;

$('.treejs-label').click(txtClick);

function txtClick() {
	console.log(this);
	
	console.log(this.parentNode.nodeId); // EZ IGY JÓ!
}

function onlyOne() {
/*
    if (myTree.values.length > 1) {
		sel = '';
		for(var i=0; i<myTree.values.length; i++) {
			if (myTree.values[i] != lastSelect) {
				sel = myTree.values[i];			
			}		
		}
		lastSelect = sel;
		myTree.values = [sel];
    } else if (myTree.values.length == 1) {
		lastSelect = myTree.values[0]    
    } else {
    	lastSelect = '';
    }
*/    
}

function addSibling(arr) {
   if (lastSelect == '') return;
	var i = -1;
	for (var j=0; j<arr.length; j++) {
		if (arr[j].id == lastSelect) {
			i = j;		
		}	
	}
	if (i >= 0) {
		console.log('splice előtt',arr,i);
		arr.splice(i+1, 0, {"id":newId, "text":"item"+newId} );
		console.log('splice után',arr,i);
		newId++;
		var myTree = new Tree('#container', {
		  data: treeData,
		  onChange: function() {
		    window.setTimeout(onlyOne,300);
		  },
		});
	} else {
		for (var j=0; j < arr.length; j++) {
			if (arr[j].children != undefined) {
				addSibling(arr[j].children);
			}			
		}
	}
}


</script>
</html>